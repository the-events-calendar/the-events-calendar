name: 'PHPCS'
on: [pull_request]

jobs:
  conditional:
    uses: ./.github/workflows/reusable/php-change-detector.yml
    with:
      skip-flag: phpcs
    outputs:
      has-php-changes: ${{ jobs.conditional.outputs.has-php-changes }}
      should-run: ${{ jobs.conditional.outputs.should-run }}

  phpcs:
    needs:
      - conditional
    if: needs.conditional.outputs.should-run == '1'
    uses: stellarwp/github-actions/.github/workflows/phpcs.yml@main
    with:
      ref: ${{ github.event.inputs.ref }}
      change_permissions: false
    secrets:
      access-token: ${{ secrets.GHA_BOT_TOKEN_MANAGER }}
